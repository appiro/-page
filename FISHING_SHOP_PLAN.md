# 🎣 釣具屋システム実装計画

## 📋 概要

コインを使って釣りアイテムを購入できる「釣具屋」機能を追加します。

---

## 🛍️ アイテム一覧

### 1. 釣り竿（Fishing Rod）

| アイテム名 | 価格 | 耐久度 | 効果 | 説明 |
|-----------|------|--------|------|------|
| **竹の釣り竿** | 50コイン | 10回 | レア+5% | 初心者向けの安価な釣り竿 |
| **カーボン竿** | 150コイン | 20回 | レア+10% | 軽量で扱いやすい中級者向け |
| **プロ仕様竿** | 300コイン | 30回 | レア+15% | プロ仕様の高性能釣り竿 |
| **伝説の竿** | 500コイン | 50回 | レア+25% | 伝説の釣り師が使った最高級品 |

**効果詳細**:
- レア+5%: レアリティ3の確率が5%→10%、レアリティ4が1%→2%
- レア+10%: レアリティ3の確率が5%→15%、レアリティ4が1%→3%
- レア+15%: レアリティ3の確率が5%→20%、レアリティ4が1%→5%
- レア+25%: レアリティ3の確率が5%→30%、レアリティ4が1%→8%

---

### 2. 撒き餌（Bait）

| アイテム名 | 価格 | 使用回数 | 効果 | 説明 |
|-----------|------|---------|------|------|
| **パンくず** | 30コイン | 5回 | レア1確率+10% | 小魚が好む餌 |
| **ミミズ** | 50コイン | 5回 | レア2確率+10% | 中型魚が好む餌 |
| **イワシ** | 100コイン | 5回 | レア3確率+10% | 大型魚が好む餌 |
| **特製ルアー** | 200コイン | 5回 | レア4確率+15% | 超レア魚を引き寄せる |

**効果詳細**:
- 特定のレアリティの出現率を上げる
- 他のレアリティの確率は比例して減少

---

### 3. 特殊アイテム

| アイテム名 | 価格 | 使用回数 | 効果 | 説明 |
|-----------|------|---------|------|------|
| **幸運のお守り** | 100コイン | 10回 | 新種確率+20% | 未入手の魚が出やすくなる |
| **釣りチケット×5** | 80コイン | - | チケット+5 | 釣りチケットを5枚購入 |
| **釣りチケット×10** | 150コイン | - | チケット+10 | 釣りチケットを10枚購入（お得） |
| **魚群探知機** | 250コイン | 3回 | 10連確定 | 次の釣りで必ず10匹釣れる |
| **黄金の餌** | 500コイン | 1回 | レア4確定 | 次の釣りで必ずレア4が釣れる |

---

## 🏗️ データ構造

### FishingItem モデル

```dart
class FishingItem {
  final String id;
  final String name;
  final String description;
  final int price;
  final FishingItemType type;
  final int durability; // 使用回数（0 = 無限）
  final Map<String, dynamic> effects; // 効果データ
  final String iconEmoji;
  
  const FishingItem({
    required this.id,
    required this.name,
    required this.description,
    required this.price,
    required this.type,
    required this.durability,
    required this.effects,
    required this.iconEmoji,
  });
}

enum FishingItemType {
  rod,      // 釣り竿
  bait,     // 撒き餌
  charm,    // お守り
  ticket,   // チケット
  special,  // 特殊アイテム
}
```

### UserInventory（所持アイテム）

```dart
class UserInventory {
  final String itemId;
  final int remainingUses; // 残り使用回数
  final DateTime acquiredAt;
  
  const UserInventory({
    required this.itemId,
    required this.remainingUses,
    required this.acquiredAt,
  });
}
```

---

## 🎨 UI設計

### 釣具屋画面（FishingShopScreen）

```
┌─────────────────────────────────┐
│ ← 釣具屋                        │
│                    💰 1,234コイン│
├─────────────────────────────────┤
│ 🎣 釣り竿                        │
│ ┌─────────────────────────────┐ │
│ │ 🎣 竹の釣り竿                │ │
│ │ レア+5% | 耐久度: 10回       │ │
│ │ 初心者向けの安価な釣り竿     │ │
│ │                   💰 50コイン│ │
│ └─────────────────────────────┘ │
│                                 │
│ 🐟 撒き餌                        │
│ ┌─────────────────────────────┐ │
│ │ 🍞 パンくず                  │ │
│ │ レア1確率+10% | 5回使用      │ │
│ │ 小魚が好む餌                 │ │
│ │                   💰 30コイン│ │
│ └─────────────────────────────┘ │
│                                 │
│ ✨ 特殊アイテム                  │
│ ┌─────────────────────────────┐ │
│ │ 🍀 幸運のお守り              │ │
│ │ 新種確率+20% | 10回使用      │ │
│ │ 未入手の魚が出やすくなる     │ │
│ │                  💰 100コイン│ │
│ └─────────────────────────────┘ │
└─────────────────────────────┘
```

### 所持アイテム画面（タブ追加）

```
┌─────────────────────────────────┐
│ 釣り | 🎒所持品 | 図鑑            │
├─────────────────────────────────┤
│ 装備中の釣り竿                   │
│ ┌─────────────────────────────┐ │
│ │ 🎣 カーボン竿                │ │
│ │ レア+10% | 残り: 15/20回    │ │
│ │         [装備解除] [修理]    │ │
│ └─────────────────────────────┘ │
│                                 │
│ 所持アイテム                     │
│ ┌─────────────────────────────┐ │
│ │ 🍞 パンくず × 2              │ │
│ │ 残り: 5回/5回                │ │
│ │                     [使用]   │ │
│ └─────────────────────────────┘ │
└─────────────────────────────┘
```

---

## 🔧 実装ステップ

### Phase 1: データモデル
1. ✅ `FishingItem` モデル作成
2. ✅ `UserInventory` モデル作成
3. ✅ アイテムマスターデータ定義

### Phase 2: バックエンド
1. ✅ `FishingShopService` 作成
2. ✅ アイテム購入ロジック
3. ✅ アイテム使用ロジック
4. ✅ 釣りロジックにアイテム効果を統合

### Phase 3: UI
1. ✅ `FishingShopScreen` 作成
2. ✅ `InventoryScreen` 作成
3. ✅ 釣り画面にアイテム選択UI追加

### Phase 4: データ永続化
1. ✅ Firestore/Drift にインベントリ保存
2. ✅ アイテム使用履歴の記録

---

## 📊 アイテム効果の実装

### 釣り竿の効果

```dart
// レア度上昇の計算
double getRarityBoost(FishingItem? rod) {
  if (rod == null) return 0.0;
  return rod.effects['rarityBoost'] ?? 0.0;
}

// 確率調整
int _catchOneFish(double rarityBoost) {
  final roll = _random.nextInt(100);
  
  // レア度上昇分を高レアリティに振り分け
  int rarity3Threshold = 94 - (rarityBoost * 0.6).toInt();
  int rarity4Threshold = 99 - (rarityBoost * 0.4).toInt();
  
  if (roll < 72) {
    return 1;
  } else if (roll < 94) {
    return 2;
  } else if (roll < rarity3Threshold) {
    return 3;
  } else {
    return 4;
  }
}
```

### 撒き餌の効果

```dart
// 特定レアリティの確率上昇
int _catchOneFishWithBait(FishingItem? bait) {
  final roll = _random.nextInt(100);
  
  if (bait != null) {
    int targetRarity = bait.effects['targetRarity'];
    int boost = bait.effects['boost'];
    
    // ターゲットレアリティの確率を上げる
    // 実装詳細は後述
  }
  
  // 通常の抽選
  return _catchOneFish(0.0);
}
```

---

## 💰 価格バランス

### コイン獲得量（現状）
- ワークアウト完了: 10コイン
- 週間目標達成: 50コイン

### 想定プレイ
- 1週間で3回ワークアウト: 30コイン
- 週間目標達成: 50コイン
- **週間合計: 80コイン**

### アイテム価格設定
- 安価（30-50コイン）: 1週間で複数購入可能
- 中価格（100-200コイン）: 2-3週間で購入可能
- 高価格（300-500コイン）: 1ヶ月以上の目標

---

## 🎮 ゲームバランス

### 釣り竿の使い分け
- **初心者**: 竹の釣り竿（コスパ良い）
- **中級者**: カーボン竿（バランス型）
- **上級者**: プロ仕様竿（高性能）
- **コレクター**: 伝説の竿（最高性能）

### 撒き餌の使い分け
- **図鑑埋め**: 幸運のお守り
- **特定魚狙い**: 対応する撒き餌
- **超レア狙い**: 特製ルアー + 伝説の竿

---

## 🚀 今後の拡張案

### 追加アイテム案
1. **釣り竿の修理キット**: 耐久度を回復
2. **経験値ブースター**: 釣り経験値2倍
3. **図鑑コンプリート報酬**: 特別な釣り竿
4. **季節限定アイテム**: 期間限定の特殊効果
5. **ガチャチケット**: ランダムアイテム獲得

### 機能拡張
1. **釣り竿の強化システム**: コインで性能アップ
2. **アイテム合成**: 低レアアイテムを合成して高レア作成
3. **デイリーショップ**: 日替わりセール
4. **実績システム**: 特定条件でアイテム解放

---

## ✅ 実装開始

次のステップで実装を開始します：
1. データモデルの作成
2. アイテムマスターデータの定義
3. 釣具屋画面の実装
4. アイテム効果の統合

準備完了！🎣
